---
layout: project.njk
title: Bookmarklet for motorcycle digest
---
# {{ title }}

<p>
  This is a bookmarklet for auto-scraping Facebook Marketplace listings from within the browser. Save me to your bookmarks bar!
</p>
<p>
  You can do this in Chrome, for example, by dragging the link below directly onto your bookmarks bar. If you don't see your bookmarks bar, you can toggle it on with CTRL-SHIFT-B
</p>

<a href="javascript: (() => {const SEARCH_TERMS='BMW R60/2,BMW R50/2,BMW R69S,BMW R69 S,BMW R80GS,BMW R80 GS,BMW R100GS,BMW R100 GS,BMW R90S,BMW R90 S,Norton Commando,Honda CL77,Kawasaki Z1,Honda RC30',LOCATION_COORDINATES=[{latitude:43.4708,longitude:-74.4131}],REQUEST_SPACING=150;let fbRequestToken;function parseSearchResponse(e){return e.data.marketplace_search.feed_units.edges.map((e=>e.node.listing))}function currentDay(){return Math.floor(Date.now()/864e5)}function requestBody(e,t){const a={__hs:'19650.HYP:comet_pkg.2.1..2.1',fb_dtsg:fbRequestToken,fb_api_caller_class:'RelayModern',fb_api_req_friendly_name:'CometMarketplaceSearchContentContainerQuery',variables:{buyLocation:{latitude:36,longitude:-115},contextual_data:null,count:24,cursor:null,flashSaleEventID:'',hasFlashSaleEventID:!1,marketplaceSearchMetadataCardEnabled:!0,params:{bqf:{callsite:'COMMERCE_MKTPLACE_WWW',query:e},browse_request_params:{commerce_enable_local_pickup:!0,commerce_enable_shipping:!0,commerce_search_and_rp_available:!0,commerce_search_and_rp_category_id:[],commerce_search_and_rp_condition:null,commerce_search_and_rp_ctime_days:null,filter_location_latitude:36,filter_location_longitude:-115,filter_price_lower_bound:0,filter_price_upper_bound:214748364700,filter_radius_km:8e4},custom_request_params:{browse_context:null,contextual_filters:[],referral_code:null,saved_search_strid:null,search_vertical:'C2C',seo_url:null,surface:'SEARCH',virtual_contextual_filters:[]}},savedSearchID:null,savedSearchQuery:e,scale:2,shouldIncludePopularSearches:!1,topicPageParams:{location_id:'109546952404225',url:null}},doc_id:6668288286594651},o=Object.keys(a).reduce(((e,t)=>{const o=e.length?'&':'?',n=a[t];return e+o+t+'='+('object'==typeof n?JSON.stringify(n):n)}),'');return encodeURI(o)}async function holdFor(e){await new Promise((async t=>{await setTimeout(t,e)}))}async function handleFacebookRequest(e){return console.log('before'),await holdFor(REQUEST_SPACING),console.log('after'),fetch('https://www.facebook.com/api/graphql/',{headers:{accept:'*/*','accept-language':'en-US,en;q=0.9','content-type':'application/x-www-form-urlencoded','sec-fetch-mode':'cors','sec-fetch-site':'same-origin',cookie:'datr=4VJEZOB9kjFOecbVWRUa40Tx; sb=4VJEZCjVJ6i33B1GQw7s8T2U; c_user=4201942; m_ls=%7B%22c%22%3A%7B%221%22%3A%22HCwAABaYZxaU_sjhDBMFFqz3gAQA%22%2C%222%22%3A%22GTwVQBxMAAAWAhaKtuLSDBYAABV-HEwAABYAFo6o-dIMFgAAFcYBHEwAABaiAhbijYTTDBYAABYoAA%22%2C%2295%22%3A%22HCwAABZkFranhcQDEwUWrPeABAA%22%7D%2C%22d%22%3A%22e0741f88-3484-41ea-b536-88512955527f%22%2C%22s%22%3A%221%22%2C%22u%22%3A%22a0lwtk%22%7D; presence=C%7B%22t3%22%3A%5B%5D%2C%22utc3%22%3A1697813400241%2C%22v%22%3A1%7D; wd=1332x758; xs=17%3AeHrN1bkWIhXQ0Q%3A2%3A1684077500%3A-1%3A3021%3A%3AAcWpxse9v6hsG70uKGORJJfJ9Tr1llXA0jROJM-ul8Q; fr=1oOjTPvz6l67gogki.AWUWa2k_3JWWaI3bI4wz9Kyjdn0.BlMrcG.cB.AAA.0.0.BlMrcG.AWWrw50YVBE; usida=eyJ2ZXIiOjEsImlkIjoiQXMydTd4NDFybDQybjQiLCJ0aW1lIjoxNjk3ODIyNjkzfQ%3D%3D','Referrer-Policy':'strict-origin-when-cross-origin'},body:requestBody('1968 BMW R60/2',e),method:'POST'}).then((e=>(console.log('res',e),e.json()))).then((e=>{const t=parseSearchResponse(e);return t.forEach((e=>{})),t}))}function setFbRequestToken(){const e=document.querySelector('#__eqmc'),t=JSON.parse(e?.textContent);fbRequestToken=t.f}function formatResults(e){return e.map((e=>({url:'https://facebook.com/marketplace/item/'+e.id,title:e.marketplace_listing_title,price:e.listing_price.formatted_amount,image:e.primary_listing_photo?.image?.uri})))}function filterResults(e){const t=SEARCH_TERMS.split(',');return e.filter((e=>!!t.find((t=>{const a=new RegExp(t,'ig');return e.title.match(a)}))))}function displayListings(e){const t=document.querySelector('body'),a=document.createElement('div');a.style.zIndex=1e9,a.style.padding='10px',a.style.position='absolute',a.style.margin='auto',a.style.width='90%',a.style.height='90%',a.style.left=0,a.style.right=0,a.style.top=0,a.style.bottom=0,a.style.background='white',a.style.overflowY='scroll',t.appendChild(a),e.forEach((e=>{const t=document.createElement('div'),o=document.createElement('p'),n=document.createElement('a'),r=document.createElement('img');n.innerText=e.title+' | '+e.price,n.href=e.url,r.src=e.image,r.style.height='300px',r.style.width='auto',t.appendChild(o),o.appendChild(n),t.appendChild(r),a.appendChild(t)}))}async function main(){let e=[];setFbRequestToken();let t=0;for(;t<LOCATION_COORDINATES.length;){const a=LOCATION_COORDINATES[t];let o=await handleFacebookRequest(a);console.log('results',o),o=formatResults(o),o=filterResults(o),e=[...e,...o],t++}console.log('listings.length',e.length),displayListings(e)}main();} )();">Moto Bookmarklet v0.0</a>
    <!-- feed it through our jsmin filter to minify -->

<p>
  Once you have this bookmarklet saved, you can use it with the following actions:
  <ol>
    <li>Visit <a href="https://facebook.com/marketplace" target="_blank">facebook marketplace</a></li>
    <li>Click the bookmarklet from the bookmarks bar</li>
  </ol>
  After a few seconds, a white overlay will appear with your results
</p>
