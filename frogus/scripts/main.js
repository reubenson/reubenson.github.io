(()=>{var t={645:t=>{"use strict";function e(t){if(this.size=0|t,this.size<=1||0!=(this.size&this.size-1))throw new Error("FFT size must be a power of two and bigger than 1");this._csize=t<<1;for(var e=new Array(2*this.size),i=0;i<e.length;i+=2){const t=Math.PI*i/this.size;e[i]=Math.cos(t),e[i+1]=-Math.sin(t)}this.table=e;for(var n=0,s=1;this.size>s;s<<=1)n++;this._width=n%2==0?n-1:n,this._bitrev=new Array(1<<this._width);for(var o=0;o<this._bitrev.length;o++){this._bitrev[o]=0;for(var r=0;r<this._width;r+=2){var h=this._width-r-2;this._bitrev[o]|=(o>>>r&3)<<h}}this._out=null,this._data=null,this._inv=0}t.exports=e,e.prototype.fromComplexArray=function(t,e){for(var i=e||new Array(t.length>>>1),n=0;n<t.length;n+=2)i[n>>>1]=t[n];return i},e.prototype.createComplexArray=function(){const t=new Array(this._csize);for(var e=0;e<t.length;e++)t[e]=0;return t},e.prototype.toComplexArray=function(t,e){for(var i=e||this.createComplexArray(),n=0;n<i.length;n+=2)i[n]=t[n>>>1],i[n+1]=0;return i},e.prototype.completeSpectrum=function(t){for(var e=this._csize,i=e>>>1,n=2;n<i;n+=2)t[e-n]=t[n],t[e-n+1]=-t[n+1]},e.prototype.transform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=0,this._transform4(),this._out=null,this._data=null},e.prototype.realTransform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=0,this._realTransform4(),this._out=null,this._data=null},e.prototype.inverseTransform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=1,this._transform4();for(var i=0;i<t.length;i++)t[i]/=this.size;this._out=null,this._data=null},e.prototype._transform4=function(){var t,e,i=this._out,n=this._csize,s=1<<this._width,o=n/s<<1,r=this._bitrev;if(4===o)for(t=0,e=0;t<n;t+=o,e++){const i=r[e];this._singleTransform2(t,i,s)}else for(t=0,e=0;t<n;t+=o,e++){const i=r[e];this._singleTransform4(t,i,s)}var h=this._inv?-1:1,a=this.table;for(s>>=2;s>=2;s>>=2){var f=(o=n/s<<1)>>>2;for(t=0;t<n;t+=o)for(var u=t+f,l=t,c=0;l<u;l+=2,c+=s){const t=l,e=t+f,n=e+f,s=n+f,o=i[t],r=i[t+1],u=i[e],d=i[e+1],p=i[n],v=i[n+1],m=i[s],g=i[s+1],_=o,y=r,w=a[c],I=h*a[c+1],b=u*w-d*I,T=u*I+d*w,x=a[2*c],z=h*a[2*c+1],A=p*x-v*z,C=p*z+v*x,E=a[3*c],O=h*a[3*c+1],S=m*E-g*O,L=m*O+g*E,F=_+A,M=y+C,R=_-A,k=y-C,q=b+S,N=T+L,D=h*(b-S),K=h*(T-L),P=F+q,$=M+N,B=F-q,j=M-N,G=R+K,U=k-D,H=R-K,J=k+D;i[t]=P,i[t+1]=$,i[e]=G,i[e+1]=U,i[n]=B,i[n+1]=j,i[s]=H,i[s+1]=J}}},e.prototype._singleTransform2=function(t,e,i){const n=this._out,s=this._data,o=s[e],r=s[e+1],h=s[e+i],a=s[e+i+1],f=o+h,u=r+a,l=o-h,c=r-a;n[t]=f,n[t+1]=u,n[t+2]=l,n[t+3]=c},e.prototype._singleTransform4=function(t,e,i){const n=this._out,s=this._data,o=this._inv?-1:1,r=2*i,h=3*i,a=s[e],f=s[e+1],u=s[e+i],l=s[e+i+1],c=s[e+r],d=s[e+r+1],p=s[e+h],v=s[e+h+1],m=a+c,g=f+d,_=a-c,y=f-d,w=u+p,I=l+v,b=o*(u-p),T=o*(l-v),x=m+w,z=g+I,A=_+T,C=y-b,E=m-w,O=g-I,S=_-T,L=y+b;n[t]=x,n[t+1]=z,n[t+2]=A,n[t+3]=C,n[t+4]=E,n[t+5]=O,n[t+6]=S,n[t+7]=L},e.prototype._realTransform4=function(){var t,e,i=this._out,n=this._csize,s=1<<this._width,o=n/s<<1,r=this._bitrev;if(4===o)for(t=0,e=0;t<n;t+=o,e++){const i=r[e];this._singleRealTransform2(t,i>>>1,s>>>1)}else for(t=0,e=0;t<n;t+=o,e++){const i=r[e];this._singleRealTransform4(t,i>>>1,s>>>1)}var h=this._inv?-1:1,a=this.table;for(s>>=2;s>=2;s>>=2){var f=(o=n/s<<1)>>>1,u=f>>>1,l=u>>>1;for(t=0;t<n;t+=o)for(var c=0,d=0;c<=l;c+=2,d+=s){var p=t+c,v=p+u,m=v+u,g=m+u,_=i[p],y=i[p+1],w=i[v],I=i[v+1],b=i[m],T=i[m+1],x=i[g],z=i[g+1],A=_,C=y,E=a[d],O=h*a[d+1],S=w*E-I*O,L=w*O+I*E,F=a[2*d],M=h*a[2*d+1],R=b*F-T*M,k=b*M+T*F,q=a[3*d],N=h*a[3*d+1],D=x*q-z*N,K=x*N+z*q,P=A+R,$=C+k,B=A-R,j=C-k,G=S+D,U=L+K,H=h*(S-D),J=h*(L-K),Q=P+G,V=$+U,W=B+J,X=j-H;if(i[p]=Q,i[p+1]=V,i[v]=W,i[v+1]=X,0!==c){if(c!==l){var Y=B+-h*J,Z=-h*H-j,tt=P+-h*G,et=-$- -h*U,it=t+u-c,nt=t+f-c;i[it]=Y,i[it+1]=Z,i[nt]=tt,i[nt+1]=et}}else{var st=P-G,ot=$-U;i[m]=st,i[m+1]=ot}}}},e.prototype._singleRealTransform2=function(t,e,i){const n=this._out,s=this._data,o=s[e],r=s[e+i],h=o+r,a=o-r;n[t]=h,n[t+1]=0,n[t+2]=a,n[t+3]=0},e.prototype._singleRealTransform4=function(t,e,i){const n=this._out,s=this._data,o=this._inv?-1:1,r=2*i,h=3*i,a=s[e],f=s[e+i],u=s[e+r],l=s[e+h],c=a+u,d=a-u,p=f+l,v=o*(f-l),m=c+p,g=d,_=-v,y=c-p,w=d,I=v;n[t]=m,n[t+1]=0,n[t+2]=g,n[t+3]=_,n[t+4]=y,n[t+5]=0,n[t+6]=w,n[t+7]=I}},995:t=>{t.exports=function(t){return 0===t?1:(t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16))}}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,i),o.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=i(645),e=i.n(t),n=i(995),s=i.n(n);function o(t){const e=[];for(var i=0;i<t;i++)e.push(0);return e}class r{constructor(t,i,n="CONSTANT"){!function(t){if(!Number.isInteger(t)||t<1)throw new TypeError(`size must be a positive integer. Got ${t}`)}(t),function(t){if(0===t.length||t.length%2!=1)throw new RangeError(`kernel must have an odd positive length. Got ${t.length}`)}(i),function(t){if("CONSTANT"!==t&&"CUT"!==t)throw new RangeError(`unexpected border type: ${t}`)}(n),this.size=t,this.kernelOffset=(i.length-1)/2,this.doubleOffset=2*this.kernelOffset,this.borderType=n;const r=t+this.doubleOffset;this.fftLength=s()(Math.max(r,2)),this.fftComplexLength=2*this.fftLength,this.fft=new(e())(this.fftLength),i=i.slice().reverse();const a=o(this.fftComplexLength);this.fftKernel=o(this.fftComplexLength),h(i,a,this.fftComplexLength),this.fft.transform(this.fftKernel,a),this.paddedInput=o(this.fftComplexLength),this.fftInput=o(this.fftComplexLength),this.ifftOutput=o(this.fftComplexLength),this.result=a}convolve(t){!function(t,e){if(t!==e)throw new RangeError(`input length (${t}) does not match setup size (${e})`)}(t.length,this.size),h(t,this.paddedInput,this.fftComplexLength),this.fft.transform(this.fftInput,this.paddedInput);for(var e=0;e<this.fftInput.length;e+=2){const t=this.fftInput[e]*this.fftKernel[e]-this.fftInput[e+1]*this.fftKernel[e+1];this.fftInput[e+1]=this.fftInput[e]*this.fftKernel[e+1]+this.fftInput[e+1]*this.fftKernel[e],this.fftInput[e]=t}this.fft.inverseTransform(this.ifftOutput,this.fftInput);const i=this.fft.fromComplexArray(this.ifftOutput,this.result);return"CONSTANT"===this.borderType?i.slice(this.kernelOffset,this.kernelOffset+t.length):i.slice(this.doubleOffset,t.length)}}function h(t,e,i){let n=0;for(;n<t.length;n++)e[2*n]=t[n],e[2*n+1]=0;for(n*=2;n<i;n+=2)e[n]=0,e[n+1]=0}var a=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function h(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,h)}a((n=n.apply(t,e||[])).next())}))};class f{constructor(t){this.shynessInterval=100,this.audioConfig=t,this.shyness=1,this.audioImprint=new Float32Array(1024),this.isInitialized=!1,this.loadSample(),this.initialize(),this.setTimeout()}initialize(){return a(this,void 0,void 0,(function*(){let t=new Float32Array(1024);this.audioImprint=yield this.audioConfig.analyseSample(this.audioElement,t),this.fft=new r(1024,this.audioImprint),this.isInitialized=!0,console.log("frog initialized!",this.audioImprint)}))}loadSample(){this.audioElement=new Audio,this.audioElement.src="https://reubenson.com/frogus/audio/Aneides_lugubris90.mp3",this.audioElement.controls=!1,this.audioElement.loop=!1,this.audioElement.autoplay=!1,this.audioElement.crossOrigin="anonymous"}setTimeout(){setTimeout(this.sing.bind(this),this.getIntervalLength())}updateShyness(){const t=this.audioConfig.getMicrophoneFFT();console.log("mic",t);const e=this.fft.convolve(t);console.log("data",e),this.shyness=1}getIntervalLength(){return 500+4500*this.shyness}playSample(){this.audioElement.play()}sing(){this.updateShyness(),this.playSample(),this.setTimeout()}}class u{constructor(){this.freqLimit=5e3,this.freqBandwidth=10,this.sampleRate=44100,this.ctx=new window.AudioContext,this.fftSize=Math.pow(2,Math.ceil(Math.log2(this.sampleRate/this.freqBandwidth))),this.setDeviceId(),console.log("deviceId",this.deviceId),this.initializeAudio()}getMicrophoneFFT(){const t=new Float32Array(1024);return this.analyser.getFloatFrequencyData(t),t}setDeviceId(){const t=["","Built-in Microphone"];navigator.mediaDevices.enumerateDevices().then((e=>{console.log("devices",e);for(var i=!1,n=0;n<t.length;n++)for(var s=new RegExp(t[n],"ig"),o=0;o<e.length;o++)!i&&"audioinput"==e[o].kind&&e[o].label.match(s)&&(this.deviceId=e[o].deviceId,this.groupId=e[o].groupId,i=!0);this.deviceId=this.deviceId||"default"}))}initializeAudio(){this.ctx;let t={audio:{}};this.deviceId?t.audio={deviceId:{exact:this.deviceId}}:this.groupId&&(t.audio={groupId:{exact:this.groupId}})}analyseSample(t,e){return a(this,void 0,void 0,(function*(){const i=this.ctx.createMediaElementSource(t),n=this.ctx.createAnalyser();n.fftSize=2048,n.smoothingTimeConstant=.96;const s=n.frequencyBinCount,o=new Float32Array(s);function r(t,e){return n.getFloatFrequencyData(o),o.forEach(((i,n)=>{e[n]+=i===-1/0?0:1*i/t})),e}return i.connect(n),t.loop=!0,t.play(),e=yield function(){return a(this,void 0,void 0,(function*(){let i=0;return yield new Promise((n=>a(this,void 0,void 0,(function*(){for(;i<20;)e=r(20,e),yield new Promise((t=>setTimeout(t,100))),i++;t.pause(),n(e)}))))}))}(),t.loop=!1,t.pause(),e}))}}!function(){const t=document.querySelector("button");null==t||t.addEventListener("click",(function(){const t=new u;t.initializeAudio(),new f(t)}))}()})()})();